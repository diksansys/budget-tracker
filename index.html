<!DOCTYPE html>
<html>
  <head>
    <title>FIREBUDGET - v1.1.6</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="assets/img/favicon_io/site.webmanifest">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="./assets/css/base.css" rel="stylesheet">
  </head>
  <body>
    <div class="main-content">
        <div class="body-section">
            <div class="head-section">
                <div class="head-title">
                    <div class="title-wrap"> 
                        <span>FIREBUDGET </span> <span style="float:right">v1.1.6</span>
                    </div>  
                </div>  
            </div> 
            <div class="main-section container"> 
                <div class="top-bar-section">
                    <div class="top-bar-wrap row align-items-center">
                        <div class="tb-welcome col-4">
                            <span>Hello</span><span class="tbw-user-name">User</span>
                        </div>
                        <div class="col-8">
                            <div class="tb-action">
                                <span class="material-icons">filter_list</span>
                            </div> 
                            <div class="tb-reset">
                                <span class="material-icons">sync</span>
                            </div> 
                        </div>
                    </div>
                    <div class="search-wrap" style="display:none;">  
                        <form class="form--search">  
                            <div class="alert alert-success" role="alert" style="display:none"></div>
                            <div class="alert alert-danger" role="alert" style="display:none"></div>
                            <div class="form-input-row"> 
                                <div class="input-field">
                                    <span class="input-label">From Date*</span>
                                    <input placeholder="From Date" id="lsFromDate" type="date" class="form-control datepicker" required>
                                    
                                </div>
                                <div class="input-field">
                                    <span class="input-label">To Date*</span>
                                    <input placeholder="To Date" id="lsToDate" type="date" class="form-control datepicker" required>
                                    
                                </div> 
                                <div class="input-field">
                                    <span class="input-label">Category (optional)</span>
                                    <select id="lsCategory" class="form-control">
                                        <option value="" disabled selected>Search By Category</option>
                                        <option value="VEX">Variable Expense</option>
                                        <option value="FEX">Fixed Expense</option>
                                        <option value="INV">Investment</option>
                                        <option value="INC">Income</option>
                                    </select> 
                                </div>
                                <div class="input-field">
                                    <span class="input-label">Sub Category (optional)</span>
                                    <select id="lsSubCategory" class="form-control">
                                        <option value="" disabled selected>Search By Sub Category </option> 
                                    </select> 
                                </div>
                                <div class="btn-field">
                                    <button class="btn btn-outline-success" id="lsSubmit" type="button" name="action">Search</button>
                                    <button class="btn btn-outline-dark" id="lsReset" type="button" name="action">Reset</button>
                                    <button class="btn btn-outline-secondary" id="lsCancel" type="button" name="action">Close</button>
                                </div>
                            </div>  
                        </form>
                    </div>  
                </div>
                <div class="overview-section">
                    <div class="stats-wrap">
                        <div class="sw-title-wrap row align-items-center">
                            <div class="swt-title col-8">
                                <div class="swt-title-text"><span>Balance</span></div>
                                <div class="swt-title-body"><span>--</span></div>
                            </div> 
                            <div class="swt-action col-4 text-right">
                                <div class="swt-action-icons"> 
                                    <div class="swt-date-range">
                                        <span class="swt-date swtFromDate">--</span>
                                        <span class="swt-date swtToDate">--</span>
                                    </div> 
                                </div>
                            </div>
                        </div>
                        <div class="sw-chart-wrap">
                            <div class="swt-chart-main">
                                <div id="myChart"></div> 
                            </div>  
                        </div>
                    </div>
                    <div class="info-wrap">
                        <!--TO BE FETCHED-->>
                    </div>
                    <div class="category-wrap">
                        <div class="cw-content row">
                            <div class="col cwTotalExpense">
                                <span class="info-icon totalExpenseIcon">
                                    <i class="material-icons">monetization_on</i>
                                </span>
                                <span class="info-badge totalExpense"> ₹0</span>
                            </div>
                            <div class="col cwTotalInvestment">
                                <span class="info-icon totalInvestmentIcon">
                                    <i class="material-icons">energy_savings_leaf</i>
                                </span>
                                <span class="info-badge totalInvestment">₹0</span>
                            </div>
                            <div class="col cwTotalIncome">
                                <span class="info-icon incomeIcon">
                                    <i class="material-icons">payments</i>
                                </span>
                                <span class="info-badge totalIncome">₹0</span> 
                            </div>
                        </div>
                        <div class="cw-subcontent">
                            <div class="cwsb-unit cwsbExpense" style="display:none"></div>
                            <div class="cwsb-unit cwsbInvestment" style="display:none"></div>
                            <div class="cwsb-unit cwsbIncome" style="display:none"></div>
                        </div>
                    </div>
                </div>
                <div class="list-section"> 
                    <div class="badge-wrap">
                        <div class="ext-badge-section">
                            <!-- TO BE FETCHED -->
                        </div> 
                    </div>
                    <div class="sort-wrap">
                        <div class="sort-section"> 
                            <select id="swssSort" class="form-control">
                                <option value="" disabled selected> Sort By</option>
                                <option value="ASC_DATE">Date (Ascending)</option>
                                <option value="DESC_DATE">Date (Descending)</option>
                            </select>
                        </div> 
                    </div>
                    <div class="list-wrap">
                        <div class="list-content">
                            <ul class="list-unstyled cat-row">
                                <!--- TO BE FETCHED  -->
                            </ul> 
                        </div>
                    </div>
                </div>
            </div>
            <div class="user-section container" style="display:none">
                <div class="user-info-section">
                    <div class="user-info-img">
                        <div class="uimWrap">
                            <span class="material-icons">face</span>
                            <img src="" alt="" srcset="">
                        </div>
                    </div>
                    <div class="user-info-detail">
                        <div class="uidList">
                            <div class="uidItem userName"><span class="uidItemTitle"></span><span class="uidItemContent">User</span></div>
                            <div class="uidItem userEmail"><span class="uidItemTitle"></span><span class="uidItemContent">user@email.com</span></div>
                            <div class="uidItem userId"><span class="uidItemTitle"> </span><span class="uidItemContent">123218498687683748637</span></div>
                        </div>
                        <div class="uidAction">
                            <button class="btn btn-info uidUpdateBtn"><i class="material-icons">edit</i> Edit Profile</button>
                            <button class="btn btn-danger uidLogoutBtn"><i class="material-icons">logout</i> Logout</button>
                        </div>
                    </div> 
                </div>
            </div>
        </div>
        <div class="footer-section">
            <div class="footer-float-section text-center">
                <a href="javascript:;" class="ffs-btn"><span class="material-icons">add</span></a>
            </div>
            <div class="footer-link-wrap">
                <div class="footer-link-list">
                    <ul class="nav justify-content-center">
                        <li class="nav-item">
                            <a class="nav-link active homeFootLink" href="javascript:;">
                                <span class="material-icons">home</span>
                                <span class="fl-link-text">Home</span>
                            </a>
                        </li>
                        <li class="nav-item" >
                            <a class="nav-link payrollFootLink" disabled href="javascript:;">
                                <span class="material-icons">payments</span>
                                <span class="fl-link-text">Payroll</span>
                            </a>
                        </li> 
                        <li class="nav-item" >
                            <a class="nav-link savingFootLink" href="javascript:;">
                                <span class="material-icons">savings</span>
                                <span class="fl-link-text">Savings</span>
                            </a>
                        </li> 
                        <li class="nav-item" >
                            <a class="nav-link profileFootLink" href="javascript:;">
                                <span class="material-icons">person</span>
                                <span class="fl-link-text">Profile</span>
                            </a>
                        </li> 
                    </ul>
                </div>
            </div>
        </div>
    </div> 
    <div class="extra-content">
        <div class="ec-1-form-wrapper addExpenseForm" style="display:none">
            <div class="ec-1-form"> 
                <form> 
                    <h5>Save Expense/Transaction</h5>
                    <div class="alert alert-success" role="alert" style="display:none"></div>
                    <div class="alert alert-danger" role="alert" style="display:none"></div>
                    <input type="hidden" id="expenseId">
                    <div class="form-group fw-unit">
                        <i class="material-icons">date</i>
                      <input placeholder="Date" id="date" type="date" class="datepicker form-control" required>
                    </div>
                    <div class="form-group fw-unit">
                      <input placeholder="Amount" id="amount" type="number" class="validate form-control" required>
                    </div>
                    <div class="form-group fw-unit">
                      <input placeholder="Notes" id="notes" type="text" class="validate form-control" required>
                    </div> 
                    <div class="form-group fw-unit">
                      <select id="cat" class="form-select form-control" required>
                        <option value="" disabled selected>Choose type of transaction</option>
                        <option value="VEX">Variable Expense</option>
                        <option value="FEX">Fixed Expense</option>
                        <option value="INV">Investment</option>
                        <option value="INC">Income</option>
                      </select> 
                    </div>
                    <div class="form-group fw-unit">
                      <select id="subcat" class="form-select form-control" required>
                        <option value="" disabled selected>Choose reason of transaction</option> 
                      </select> 
                    </div>
                    <div class="form-group fw-unit">
                        <select id="recurrenceDaysSelection" data-value="" class="form-select form-control" required>
                          <option value="" disabled selected>Choose Recurrence</option> 
                          <option value="OT">One Time Transaction</option>  
                          <option value="LM">Last Day of Each Month</option> 
                          <option value="FM">First Day of Each Month</option> 
                          <option value="MO">Monthly</option> 
                          <option value="QU">Quarterly</option> 
                          <option value="YY">Yearly</option> 
                          <option value="CD">Custom (days)</option> 
                        </select> 
                    </div>
                    <div class="form-group fw-unit" id="recurrenceDaysWrap" style="display:none">
                        <input placeholder="Enter number of recurrence days" id="recurrenceDays" type="number" class="validate form-control" required>
                      </div>
                    <div class="form-group fw-unit">
                      <button class="btn btn-info" id="submit" type="button" >Save </button>
                      <button class="btn btn-info" id="closeForm" type="button" >Save </button>
                      <button class="btn btn-danger" id="deleteExpense" type="button" style="float:right;display:none;">Delete </button>
                    </div>
                  </form>
            </div>
        </div> 
    </div>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script type="module">
        import {db, where, query, collection, getDocs} from './assets/js/app.js';
        import {userConverter} from './assets/js/Entity/user.js';

        function getCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for(var i=0;i < ca.length;i++) {
                var c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
            }
            return null;
        }

        function eraseCookie(name) {   
            document.cookie = name +'=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        }

        window.onload = async function () {
            let loginToken = getCookie('loggedInUser');
            if (loginToken) { // If login token exist
                let q = query(
                    collection(db, "allowedUsers").withConverter(userConverter), 
                    where('loginToken', '==', loginToken), 
                    where('isLoggedIn', '==', true)
                );
                const querySnapshot = await getDocs(q); 
                querySnapshot.forEach((resp) => { 
                    if (resp) { 
                        // Already logged in
                        console.log('user logged in already');  
                    } else {
                        // Unknown / hack request
                        eraseCookie('loggedInUser');
                        alert('Access Denied!');
                        location.href="login.html";
                    }
                });
            }  else {
                location.href="login.html";
            }
        }  
    </script>  
    <script type="module" src="./assets/js/Events/load-list.js"></script> 
    <script type="module" src="./assets/js/Events/add-transaction.js"></script> 
    <script type="module" src="./assets/js/Events/navigation.js"></script> 
    <script type="module" src="./assets/js/Events/user-profile.js"></script> 
  </body>
</html>